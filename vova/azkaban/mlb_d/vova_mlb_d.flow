---
config:
  failure.emails: andy.zhang@vova.com.hk,kaicheng@vova.com.hk
  retries: 10
  retry.backoff: 600000

nodes:
  - name: end_flag
    type: command
    config:
      command: echo "stop job"
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - mlb_vova_rec_m_nbi_nb_d
      - mlb_algo_vova_comatrix
      - mlb_algo_vova_item2vec
      - mlb_algo_vova_mix_als
      - mlb_vova_goods_second_cat
      - mlb_vova_algo_mct_group_d
      - mlb_vova_country_detect_d
      - mlb_vova_rec_b_g_base_d_job_message_put
      - mlb_vova_rec_goods_scorebase_data_d_job_message_put
#      - mlb_vova_new_user_reg_rec_out_data

  - name: start_flag
    type: command
    config:
      command: echo "start job"

##judge#############
  - name: judge_dws_vova_buyer_goods_behave
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dws_vova_buyer_goods_behave
    dependsOn:
      - start_flag

  - name: judge_dim_vova_goods
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dim_vova_goods
    dependsOn:
      - start_flag

  - name: judge_dim_vova_buyers
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dim_vova_buyers
    dependsOn:
      - start_flag

  - name: judge_dim_vova_devices
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dim_vova_devices
    dependsOn:
      - start_flag

  - name: judge_ads_vova_goods_portrait
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh ads_vova_goods_portrait_v2
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - start_flag

  - name: judge_ads_vova_traff_control
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh ads_vova_traff_control
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - start_flag

  - name: judge_dwd_vova_fact_comment
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_fact_comment
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_dwd_vova_fact_refund
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_fact_refund
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_dim_vova_order_goods
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dim_vova_order_goods
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_dwd_vova_fact_pay
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_fact_pay
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag


  - name: judge_dwd_vova_log_common_click
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_log_common_click
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_ads_vova_goods_id_behave_2m
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh ads_vova_goods_id_behave_2m
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_dwd_vova_log_goods_click
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_log_goods_click
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_dws_vova_buyer_portrait
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dws_vova_buyer_portrait
      retries: 100
      retry.backoff: 120000
    dependsOn:
      - start_flag

  - name: judge_dim_vova_merchant
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dim_vova_merchant
    dependsOn:
      - start_flag

  - name: judge_dwd_vova_log_goods_impression
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_log_goods_impression
    dependsOn:
      - start_flag

  - name: judge_dwd_vova_fact_mbrmct_mct_cd
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh dwd_vova_fact_mbrmct_mct_cd
    dependsOn:
      - start_flag

  - name: judge_mlb_vova_user_behave_link_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/judge_check.sh mlb_vova_user_behave_link_d
    dependsOn:
      - start_flag

  - name: judge_mlb_vova_rec_b_goods_score_d_message_get
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/job_message_get.sh --jname=mlb_goods_score_vova --from=mlb --to=data --valid_hour=3
      retries: 20
      retry.backoff: 1800000
    dependsOn:
      - start_flag

########################
# [8429]Me页面推荐策略调整
  - name: mlb_vova_rec_m_nbi_nb_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/rec_m_nbi_nb_d/update.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dws_vova_buyer_goods_behave
      - judge_dim_vova_goods

# [8466]新用户冷启动用户属性召回下发策略优化 : 近180天有pv用户及激活时间
  - name: mlb_vova_buyer_activate_time
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/buyer_activate_time/update.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_devices
      - judge_dim_vova_buyers

# [8229]构建商品评分并应用于搜索及mostpopular
  - name: mlb_vova_rec_goods_scorebase_data_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/rec_b_goods_score/get_data.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_goods
      - judge_ads_vova_goods_portrait
      - judge_ads_vova_traff_control

  - name: mlb_vova_rec_goods_scorebase_data_d_job_message_put
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/job_message_put.sh --jname=ads_rec_goods_scorebase_data_d --from=data --to=java_server --jtype=1D --retry=0
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - mlb_vova_rec_goods_scorebase_data_d

# 推荐基础商品数据取数与商品标题embedding调度
  - name: mlb_vova_rec_b_g_base_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/rec_b_g_base_d/update.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_goods

  - name: mlb_vova_rec_b_g_base_d_job_message_put
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/common/job_message_put.sh --jname=ads_rec_b_g_base_d --from=data --to=java_server --jtype=1D --retry=0
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - mlb_vova_rec_b_g_base_d

# [7381]基于用户属性的新用户冷启动策略
  - name: mlb_vova_new_user_rec
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/new_user_rec/update.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dws_vova_buyer_goods_behave
      - judge_dwd_vova_fact_comment
      - judge_dwd_vova_fact_refund
      - judge_dim_vova_order_goods
      - judge_dwd_vova_fact_pay
      - judge_dim_vova_buyers
      - judge_dim_vova_goods
      - judge_ads_vova_goods_portrait

# [7832]冷启动兜底策略取数
#  - name: mlb_vova_new_user_reg_rec_get_data
#    type: command
#    config:
#      command: sh /mnt/vova-bigdata-scripts/vova/mlb/new_user_reg_rec/update.sh
#      retries: 5
#      retry.backoff: 600000
#    dependsOn:
#      - judge_dws_vova_buyer_goods_behave
#      - judge_dim_vova_goods
#      - judge_dwd_vova_fact_comment
#      - judge_dwd_vova_fact_refund
#      - judge_dim_vova_order_goods
#      - judge_dwd_vova_fact_pay
#      - judge_dim_vova_buyers
#
#  - name: mlb_vova_new_user_reg_rec_out_data
#    type: command
#    config:
#      command: sh /mnt/vova-bigdata-scripts/vova/mlb/new_user_reg_rec/out_update.sh
#      retries: 5
#      retry.backoff: 600000
#    dependsOn:
#      - mlb_vova_new_user_reg_rec_get_data
#      - mlb_vova_new_user_rec


  - name: mlb_algo_vova_comatrix
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/algo_vova_comatrix/algo_vova_comatrix.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_goods
      - judge_dwd_vova_log_goods_click
      - judge_dwd_vova_log_common_click
      - judge_ads_vova_goods_id_behave_2m
      - judge_dwd_vova_fact_pay


  - name: mlb_algo_vova_item2vec
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/algo_vova_item2vec/algo_vova_item2vec.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_goods
      - judge_dwd_vova_log_goods_click
      - judge_dwd_vova_log_common_click
      - judge_ads_vova_goods_id_behave_2m
      - judge_dwd_vova_fact_pay

  - name: mlb_algo_vova_mix_als
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/algo_vova_mix_als/algo_vova_mix_als.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_goods
      - judge_dwd_vova_log_goods_click
      - judge_dwd_vova_log_common_click
      - judge_ads_vova_goods_id_behave_2m
      - judge_dwd_vova_fact_pay


  - name: mlb_vova_algo_usercall_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/algo/ads_algo_usercall_d.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dws_vova_buyer_portrait
      - judge_dwd_vova_fact_pay
      - judge_dim_vova_goods
      - judge_ads_vova_traff_control

# [8721]首页上线新激活用户兴趣探测策略
  - name: mlb_vova_goods_second_cat
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/goods_cat/update.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dim_vova_goods

  - name: mlb_vova_algo_mct_group_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/algo/ads_algo_mct_group_d.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dwd_vova_fact_mbrmct_mct_cd
      - judge_dim_vova_merchant


  - name: mlb_vova_country_detect_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/country_detect_d/country_detect.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_dwd_vova_log_goods_impression

# [9166]首页新增用户类目偏好发现召回 依赖的表：mlb.mlb_vova_user_behave_link_d，mlb.mlb_vova_rec_b_goods_score_d

  - name: mlb_rec_m_catlike_d
    type: command
    config:
      command: sh /mnt/vova-bigdata-scripts/vova/mlb/rec_b_cat_tag_like_d/update_rec_m_catlike_d.sh
      retries: 5
      retry.backoff: 600000
    dependsOn:
      - judge_mlb_vova_user_behave_link_d
      - judge_mlb_vova_rec_b_goods_score_d_message_get

